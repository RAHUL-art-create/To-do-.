<!DOCTYPE html>
<html lang="en">
<head>
<base href="https://varshit-responsive-skyscape-enhanced-v2.example.com/">
<title>VARSHIT with Enhanced Dynamic Skyscape and Rainbow</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: 'Arial', sans-serif;
  }
  #container {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transition: background-color 2s ease;
  }
  #name {
    font-size: 12vw;
    font-weight: bold;
    z-index: 10;
    transition: color 2s ease, text-shadow 2s ease;
    text-align: center;
    user-select: none;
    position: relative;
  }
  .celestial-body {
    position: absolute;
    border-radius: 50%;
    top: 10vh;
    left: 50%;
    transform: translateX(-50%);
  }
  #sun {
    width: 15vmin;
    height: 15vmin;
    background: radial-gradient(circle, #ffff00 0%, #ff8c00 100%);
    box-shadow: 0 0 7vmin #ff8c00;
  }
  #moon {
    width: 12vmin;
    height: 12vmin;
    background: radial-gradient(circle, #f0f0f0 0%, #d0d0d0 100%);
    box-shadow: 0 0 5vmin #d0d0d0;
    overflow: hidden;
    transform: rotate(-30deg);
  }
  #moon::before {
    content: '';
    position: absolute;
    top: -2%;
    left: -2%;
    width: 104%;
    height: 104%;
    background: inherit;
    border-radius: 50%;
    transition: transform 2s ease;
  }
  .cloud {
    position: absolute;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    filter: blur(5px);
  }
  @media (max-width: 600px) {
    .cloud {
      filter: blur(3px);
    }
  }
  .cloud::before,
  .cloud::after {
    content: '';
    position: absolute;
    background: inherit;
    border-radius: inherit;
  }
  .cloud::before {
    width: 60%;
    height: 60%;
    top: -30%;
    left: 10%;
  }
  .cloud::after {
    width: 80%;
    height: 80%;
    top: -40%;
    right: 10%;
  }
  .star {
    position: absolute;
    background: white;
    clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
  }
  @keyframes twinkle {
    from { opacity: 0.5; transform: scale(1); }
    to { opacity: 1; transform: scale(1.2); }
  }
  .trailing-star {
    position: absolute;
    background: white;
    width: 2px;
    height: 2px;
    opacity: 0;
  }
  .leaf {
    position: absolute;
    width: 10px;
    height: 10px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 0 C20 20 20 80 50 100 C80 80 80 20 50 0' fill='%2348a642'/%3E%3C/svg%3E");
    background-size: contain;
    opacity: 0.7;
  }
  #controls {
    position: absolute;
    bottom: 5vh;
    left: 50%;
    transform: translateX(-50%);
    z-index: 20;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #slider {
    width: 80vw;
    max-width: 300px;
    margin: 10px 0;
  }
  #timeLabel {
    font-size: 1rem;
    color: white;
    text-shadow: 1px 1px 2px black;
    margin-top: 5px;
  }
  #rainToggle {
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 1rem;
    cursor: pointer;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    transition: background-color 0.3s;
  }
  #rainToggle:hover {
    background-color: #45a049;
  }
  #rainbow {
    position: absolute;
    width: 200%;
    height: 200vh;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -75%);
    border-radius: 50%;
    overflow: hidden;
    opacity: 0;
    transition: opacity 2s ease;
  }
  @media (max-width: 600px) {
    #rainbow {
      height: 30vh;
      top: 35vh;
    }
  }
  #rainbow::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(
      circle at 50% 100%,
      rgba(255, 0, 0, 0) 50%,
      rgba(255, 0, 0, 0.7) 51%,
      rgba(255, 165, 0, 0.7) 53%,
      rgba(255, 255, 0, 0.7) 55%,
      rgba(0, 128, 0, 0.7) 57%,
      rgba(0, 0, 255, 0.7) 59%,
      rgba(75, 0, 130, 0.7) 61%,
      rgba(238, 130, 238, 0.7) 63%,
      rgba(238, 130, 238, 0) 65%
    );
  }
  #landscape {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 30vh;
    z-index: 5;
  }
  #mountains {
    transition: fill 2s ease;
  }
  #houses {
    transition: transform 2s ease;
  }
  #vegetation {
    transition: fill 2s ease;
  }
  #todo-container {
    position: absolute;
    top: 20px;
    right: 20px;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 20px;
    max-width: 300px;
    z-index: 100;
  }
  #todo-container h2 {
    margin-top: 0;
    color: #333;
  }
  #todo-list {
    list-style-type: none;
    padding: 0;
  }
  #todo-list li {
    background-color: rgba(255, 255, 255, 0.7);
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 5px;
    transition: background-color 0.3s;
    position: relative;
  }
  #todo-list li:hover {
    background-color: rgba(255, 255, 255, 0.9);
  }
  #todo-list li input[type="checkbox"] {
    margin-right: 10px;
  }
  #todo-list input[type="checkbox"] {
    margin-right: 10px;
  }
  .remove-todo {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    padding: 5px 10px;
    background-color: #ff4d4d;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
  }
  .todo-date {
    margin-left: 10px;
    font-size: 0.8em;
    color: #666;
  }
  #todo-input-container {
    display: flex;
    margin-top: 10px;
  }
  #todo-input {
    flex-grow: 1;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 5px 0 0 5px;
  }
  #add-todo {
    padding: 5px 10px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 0 5px 5px 0;
    cursor: pointer;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    border-radius: 10px;
  }
  #multi-share-link {
    width: 100%;
    margin-bottom: 10px;
    padding: 5px;
  }
  #copy-multi-link, #close-multi-modal {
    padding: 5px 10px;
    margin-right: 10px;
  }
  .selected-task {
    background-color: #e0f7fa !important;
  }
  #share-selected-tasks {
    margin-top: 10px;
    padding: 5px 10px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  @media (max-width: 600px) {
    #name {
      font-size: 18vw;
    }
    #sun, #moon {
      top: 25vh;
    }
    #controls {
      bottom: 2vh;
    }
    #slider {
      width: 90vw;
    }
    #rainbow {
      height: 30vh;
      top: 35vh;
    }
    #landscape {
      height: 20vh;
    }
    #todo-container {
      top: 10px;
      right: 10px;
      left: 10px;
      max-width: none;
    }
    .modal-content {
      width: 95%;
      margin: 10% auto;
    }
  }
  #name[contenteditable="true"] {
    border-bottom: 2px solid white;
    padding-bottom: 5px;
  }
  .raindrop {
    position: absolute;
    background: linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(255,255,255,0.6));
    pointer-events: none;
  }
  @keyframes flowAnimation {
    0% {
      stroke-dashoffset: 0;
    }
    100% {
      stroke-dashoffset: -50;
    }
  }
  #stream1, #stream2, #stream3 {
    stroke-dasharray: 5, 5;
    animation: flowAnimation 2s linear infinite;
  }
  #stream1 {
    animation-duration: 3s;
  }
  #stream2 {
    animation-duration: 2.5s;
  }
  #stream3 {
    animation-duration: 3.5s;
  }
  @keyframes magneticWave {
    0% { transform: scale(1); opacity: 0.8; }
    100% { transform: scale(2); opacity: 0; }
  }
  @keyframes attractParticle {
    0% { transform: translate(0, 0); }
    100% { transform: translate(var(--targetX), var(--targetY)); }
  }
  .magnetic-wave {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    z-index: 9;
  }
  .attracted-particle {
    position: absolute;
    pointer-events: none;
    z-index: 8;
  }
  .new-label {
    background-color: #4CAF50;
    color: white;
    padding: 2px 5px;
    border-radius: 3px;
    font-size: 0.8em;
    margin-left: 10px;
  }
  .sender-label {
    font-size: 0.7em;
    color: #666;
    margin-left: 10px;
    display: block;
    margin-top: 2px;
  }
</style>
</head>
<body>
<div id="container">
  <div id="background"></div>
  <div id="rainbow"></div>
  <svg id="landscape" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 300">
    <path id="mountains" d="M0 300 L250 100 L500 250 L750 50 L1000 300 Z" fill="#4b6cb7" />
    <path id="vegetation" d="M0 300 Q250 250, 500 300 T1000 300" fill="#228B22" fill-opacity="0.5" />
    <g id="houses">
      <rect x="100" y="250" width="50" height="50" fill="#8B4513" />
      <polygon points="100,250 125,220 150,250" fill="#A52A2A" />
      <rect x="400" y="270" width="60" height="30" fill="#CD853F" />
      <polygon  points="400,270 430,240 460,270" fill="#D2691E" />
      <rect x="700" y="260" width="70" height="40" fill="#DEB887" />
      <polygon points="700,260 735,230 770,260" fill="#F4A460" />
    </g>
    <path id="stream1" d="M250 100 Q300 200, 350 300" fill="none" stroke="#4FC3F7" stroke-width="5" />
    <path id="stream2" d="M500 250 Q550 275, 600 300" fill="none" stroke="#4FC3F7" stroke-width="5" />
    <path id="stream3" d="M750 50 Q800 175, 850 300" fill="none" stroke="#4FC3F7" stroke-width="5" />
  </svg>
  <h1 id="name">VARSHIT</h1>
  <div id="sun" class="celestial-body"></div>
  <div id="moon" class="celestial-body"></div>
</div>
<div id="controls">
  <input type="range" id="slider" min="0" max="100" value="0">
  <span id="timeLabel">Sunrise</span>
  <button id="rainToggle">Start Rain</button>
</div>
<div id="todo-container">
  <h2>To-Do List</h2>
  <ul id="todo-list"></ul>
  <div id="todo-input-container">
    <input type="text" id="todo-input" placeholder="Add a new task">
    <button id="add-todo">Add</button>
  </div>
  <button id="share-selected-tasks" style="display: none;">Share Selected Tasks</button>
</div>
<div id="multi-share-modal" class="modal">
  <div class="modal-content">
    <h3>Share Selected Tasks</h3>
    <p>Copy this link to share the selected tasks:</p>
    <input type="text" id="multi-share-link" readonly>
    <button id="copy-multi-link">Copy Link</button>
    <button id="close-multi-modal">Close</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
<script>
let longPressTimer;
let isEditingName = false;
let witches = [];
let selectionTimer;

const background = document.getElementById('background');
const name = document.getElementById('name');
const sun = document.getElementById('sun');
const moon = document.getElementById('moon');
const slider = document.getElementById('slider');
const timeLabel = document.getElementById('timeLabel');
const container = document.getElementById('container');
const rainToggle = document.getElementById('rainToggle');
const rainbow = document.getElementById('rainbow');
const todoList = document.getElementById('todo-list');
const todoInput = document.getElementById('todo-input');
const addTodoButton = document.getElementById('add-todo');

let isRaining = false;
let selectedTasks = [];
const shareSelectedTasksBtn = document.getElementById('share-selected-tasks');
const multiShareModal = document.getElementById('multi-share-modal');
const multiShareLink = document.getElementById('multi-share-link');
const copyMultiLinkBtn = document.getElementById('copy-multi-link');
const closeMultiModalBtn = document.getElementById('close-multi-modal');

const colors = {
  sunrise: {
    sky: 'linear-gradient(to top, #ff7e5f, #feb47b)',
    sun: 'radial-gradient(circle, #ffff00 0%, #ff8c00 100%)',
  },
  day: {
    sky: 'linear-gradient(to bottom, #87CEEB, #E0F6FF)',
    sun: 'radial-gradient(circle, #ffff00 0%, #ffd700 100%)',
  },
  sunset: {
    sky: 'linear-gradient(to bottom, #FF4500, #FF6347)',
    sun: 'radial-gradient(circle, #FFD700 0%, #FF6347 100%)',
  },
  night: {
    sky: 'linear-gradient(to bottom, #191970, #000033)',
    moon: 'radial-gradient(circle, #f0f0f0 0%, #d0d0d0 100%)',
  }
};

function getContrastColor(hexcolor) {
  hexcolor = hexcolor.replace("#", "");
  const r = parseInt(hexcolor.substr(0,2),16);
  const g = parseInt(hexcolor.substr(2,2),16);
  const b = parseInt(hexcolor.substr(4,2),16);
  const yiq = ((r*299)+(g*587)+(b*114))/1000;
  return (yiq >= 128) ? 'black' : 'white';
}

function updateColors(progress) {
  let skyColor, celestialBody;
  if (progress < 25) {
    skyColor = colors.sunrise.sky;
    celestialBody = colors.sunrise.sun;
    timeLabel.textContent = "Sunrise";
  } else if (progress < 50) {
    skyColor = colors.day.sky;
    celestialBody = colors.day.sun;
    timeLabel.textContent = "Day";
  } else if (progress < 75) {
    skyColor = colors.sunset.sky;
    celestialBody = colors.sunset.sun;
    timeLabel.textContent = "Sunset";
  } else {
    skyColor = colors.night.sky;
    celestialBody = colors.night.moon;
    timeLabel.textContent = "Night";
  }
  background.style.background = skyColor;

  if (progress < 75) {
    sun.style.background = celestialBody;
    sun.style.display = 'block';
    moon.style.display = 'none';
  } else {
    moon.style.background = celestialBody;
    sun.style.display = 'none';
    moon.style.display = 'block';
  }

  const contrastColor = getContrastColor(skyColor.split(',')[1].trim());
  name.style.color = contrastColor;
  name.style.textShadow = `2px 2px 4px ${contrastColor === 'white' ? 'black' : 'white'}`;
}

function createCloud() {
  const cloud = document.createElement('div');
  cloud.className = 'cloud';
  
  const isMobile = window.innerWidth <= 600;
  
  cloud.style.width = isMobile ? (Math.random() * 15 + 10 + 'vw') : (Math.random() * 20 + 10 + 'vw');
  cloud.style.height = cloud.style.width;
  cloud.style.top = Math.random() * (isMobile ? 30 : 50) + 'vh';
  cloud.style.left = -30 + 'vw';
  cloud.style.opacity = Math.random() * 0.5 + 0.5;
  container.appendChild(cloud);

  gsap.to(cloud, {
    left: '120vw',
    duration: isMobile ? (Math.random() * 30 + 20) : (Math.random() * 50 + 40),
    ease: "none",
    onComplete: () => {
      container.removeChild(cloud);
      createCloud();
    }
  });
}

function createStar() {
  const star = document.createElement('div');
  star.className = 'star';
  star.style.width = Math.random() * 4 + 2 + 'px';
  star.style.height = star.style.width;
  star.style.top = Math.random() * window.innerHeight + 'px';
  star.style.left = Math.random() * window.innerWidth + 'px';
  container.appendChild(star);
  return star;
}

const stars = [];
for (let i = 0; i < 200; i++) {
  stars.push(createStar());
}

function createWitch() {
  const witch = document.createElement('div');
  witch.className = 'witch';
  witch.style.position = 'absolute';
  witch.style.width = '30px';
  witch.style.height = '30px';
  witch.style.backgroundImage = "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><path d=\"M50 0 L100 100 L0 100 Z\" fill=\"black\"/></svg>')";
  witch.style.backgroundSize = 'contain';
  container.appendChild(witch);
  return witch;
}

function animateWitches() {
  const createdWitches = [];
  for (let i = 0; i < 5; i++) {
    const witch = createWitch();
    createdWitches.push(witch);
    
    const angle = Math.random() * Math.PI * 2;
    const radius = 100 + Math.random() * 50;
    const duration = 10 + Math.random() * 5;
    
    gsap.set(witch, { 
      x: window.innerWidth / 2,
      y: window.innerHeight / 4,
      scale: Math.random() * 0.5 + 0.5
    });
    
    gsap.to(witch, {
      x: () => window.innerWidth / 2 + Math.cos(angle) * radius,
      y: () => window.innerHeight / 4 + Math.sin(angle) * radius,
      rotation: 360,
      duration: duration,
      ease: "none",
      repeat: -1,
      onUpdate: () => {
        if (Math.random() < 0.1) {
          createGlitter(witch);
        }
      }
    });
  }
  return createdWitches;
}

function createGlitter(witch) {
  const glitter = document.createElement('div');
  glitter.className = 'glitter';
  glitter.style.position = 'absolute';
  glitter.style.width = '3px';
  glitter.style.height = '3px';
  glitter.style.backgroundColor = 'white';
  glitter.style.borderRadius = '50%';
  container.appendChild(glitter);
  
  const witchRect = witch.getBoundingClientRect();
  const x = witchRect.left + witchRect.width;
  const y = witchRect.top + witchRect.height / 2;
  
  gsap.fromTo(glitter, 
    { x, y, scale: 0, opacity: 1 },
    { 
      x: x + (Math.random() - 0.5) * 50,
      y: y + (Math.random() - 0.5) * 50,
      scale: 1, 
      opacity: 0, 
      duration: 1, 
      ease: "power1.out",
      onComplete: () => container.removeChild(glitter)
    }
  );
}

function createTrailingStar() {
  const star = document.createElement('div');
  star.className = 'trailing-star';
  star.style.left = Math.random() * window.innerWidth + 'px';
  star.style.top = Math.random() * window.innerHeight + 'px';
  container.appendChild(star);

  gsap.to(star, {
    x: -100 - Math.random() * 100,
    y: 100 + Math.random() * 100,
    opacity: 1,
    duration: 2,
    ease: "power1.in",
    onComplete: () => {
      container.removeChild(star);
      if (parseInt(slider.value) >= 75) createTrailingStar();
    }
  });
}

function createLeaf() {
  const leaf = document.createElement('div');
  leaf.className = 'leaf';
  leaf.style.left = -10 + 'px';
  leaf.style.top = Math.random() * window.innerHeight + 'px';
  container.appendChild(leaf);

  gsap.to(leaf, {
    x: window.innerWidth + 20,
    y: '+=100',
    rotation: Math.random() * 360 * 5,
    duration: 10 + Math.random() * 5,
    ease: "power1.inOut",
    onComplete: () => {
      container.removeChild(leaf);
      createLeaf();
    }
  });
}

function addTodo() {
  const todoText = todoInput.value.trim();
  if (todoText) {
    createTodoItem(todoText);
    todoInput.value = '';
    saveTasks();
  }
}

function createTodoItem(todoText, checked = false, isNew = false, sender = '') {
  const li = document.createElement('li');
  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.checked = checked;
  const label = document.createElement('label');
  label.textContent = todoText;
  const removeButton = document.createElement('button');
  removeButton.textContent = 'Remove';
  removeButton.className = 'remove-todo';
  const dateSpan = document.createElement('span');
  dateSpan.className = 'todo-date';
  dateSpan.textContent = new Date().toLocaleDateString('en-IN');
  
  li.appendChild(checkbox);
  li.appendChild(label);
  li.appendChild(removeButton);
  li.appendChild(dateSpan);

  if (isNew) {
    const newLabel = document.createElement('span');
    newLabel.textContent = 'New';
    newLabel.className = 'new-label';
    li.appendChild(newLabel);
    setTimeout(() => {
      li.removeChild(newLabel);
    }, 10000);
  }

  if (sender) {
    const senderSpan = document.createElement('span');
    senderSpan.textContent = `From: ${sender}`;
    senderSpan.className = 'sender-label';
    li.appendChild(senderSpan);
  }

  todoList.appendChild(li);

  addTaskEventListeners(li);

  if (checked) {
    label.style.textDecoration = 'line-through';
  }

  removeButton.addEventListener('click', function(event) {
    event.stopPropagation();
    todoList.removeChild(li);
    saveTasks();
  });

  checkbox.addEventListener('change', function(event) {
    event.stopPropagation();
    if (this.checked) {
      label.style.textDecoration = 'line-through';
    } else {
      label.style.textDecoration = 'none';
    }
    saveTasks();
  });

  return li;
}

function addTaskEventListeners(li) {
  li.addEventListener('touchstart', handleTaskLongPress);
  li.addEventListener('touchend', clearTaskLongPress);
  li.addEventListener('mousedown', handleTaskLongPress);
  li.addEventListener('mouseup', clearTaskLongPress);
  li.addEventListener('mouseleave', clearTaskLongPress);
}

function handleTaskLongPress(event) {
  event.preventDefault();
  const li = event.currentTarget;
  selectionTimer = setTimeout(() => {
    toggleTaskSelection(li);
    enableQuickSelect();
  }, 1000);
}

function clearTaskLongPress() {
  clearTimeout(selectionTimer);
}

function enableQuickSelect() {
  const tasks = document.querySelectorAll('#todo-list li');
  tasks.forEach(task => {
    task.removeEventListener('touchstart', handleTaskLongPress);
    task.removeEventListener('mousedown', handleTaskLongPress);
    task.addEventListener('click', quickSelectTask);
  });
}

function quickSelectTask(event) {
  if (!event.target.classList.contains('remove-todo') && event.target.type !== 'checkbox') {
    toggleTaskSelection(this);
  }
}

function toggleTaskSelection(taskElement) {
  taskElement.classList.toggle('selected-task');
  updateSelectedTasks();
}

function updateSelectedTasks() {
  selectedTasks = Array.from(document.querySelectorAll('.selected-task')).map(task => ({
    text: task.querySelector('label').textContent,
    checked: task.querySelector('input[type="checkbox"]').checked
  }));
  shareSelectedTasksBtn.style.display = selectedTasks.length > 0 ? 'block' : 'none';
}

function saveTasks() {
  const tasks = Array.from(todoList.children).map(li => ({
    text: li.querySelector('label').textContent,
    checked: li.querySelector('input[type="checkbox"]').checked,
    sender: li.querySelector('.sender-label') ? li.querySelector('.sender-label').textContent.replace('From: ', '') : ''
  }));
  localStorage.setItem('tasks', JSON.stringify(tasks));
}

function loadTasks() {
  const savedTasks = JSON.parse(localStorage.getItem('tasks')) || [];
  savedTasks.forEach(task => createTodoItem(task.text, task.checked, false, task.sender));
}

function loadSharedTasks() {
  const urlParams = new URLSearchParams(window.location.search);
  const sharedData = urlParams.get('share');
  const sender = urlParams.get('sender') || 'Unknown';
  
  if (sharedData) {
    try {
      const sharedTasks = JSON.parse(atob(sharedData));
      sharedTasks.forEach(task => {
        createTodoItem(task.text, task.checked, true, sender);
      });
      saveTasks();
      // Clear the URL parameters after loading shared tasks
      window.history.replaceState({}, document.title, window.location.pathname);
    } catch (error) {
      console.error('Error loading shared tasks:', error);
    }
  }
}

shareSelectedTasksBtn.addEventListener('click', () => {
  const tasksToShare = selectedTasks.map(task => ({ text: task.text, checked: task.checked }));
  const sharedData = btoa(JSON.stringify(tasksToShare));
  const sender = name.textContent;
  const userId = localStorage.getItem('userId') || generateUserId();
  const shareUrl = `${window.location.origin}${window.location.pathname}?share=${sharedData}&sender=${encodeURIComponent(sender)}&userId=${userId}`;
  multiShareLink.value = shareUrl;
  multiShareModal.style.display = 'block';
});

function generateUserId() {
  const userId = Math.random().toString(36).substr(2, 9);
  localStorage.setItem('userId', userId);
  return userId;
}

copyMultiLinkBtn.addEventListener('click', () => {
  multiShareLink.select();
  document.execCommand('copy');
});

closeMultiModalBtn.addEventListener('click', () => {
  multiShareModal.style.display = 'none';
});

addTodoButton.addEventListener('click', addTodo);

todoInput.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    addTodo();
  }
});

function adjustNameSize() {
  const nameElement = document.getElementById('name');
  if (nameElement.textContent.length > 8) {
    nameElement.style.fontSize = '6vw'; 
  } else {
    nameElement.style.fontSize = '12vw';
  }
}

function createMagneticWave(x, y, color) {
  const wave = document.createElement('div');
  wave.className = 'magnetic-wave';
  wave.style.left = x + 'px';
  wave.style.top = y + 'px';
  wave.style.width = '10px';
  wave.style.height = '10px';
  wave.style.border = `2px solid ${color}`;
  wave.style.animation = 'magneticWave 1.5s ease-out';
  container.appendChild(wave);
  setTimeout(() => container.removeChild(wave), 1500);
}

function createAttractedParticle(type) {
  const particle = document.createElement('div');
  particle.className = 'attracted-particle';
  particle.style.width = '5px';
  particle.style.height = '5px';
  particle.style.backgroundColor = type === 'dust' ? '#8B4513' :
                                   type === 'cloud' ? 'white' : '#48a642';
  particle.style.left = `${Math.random() * window.innerWidth}px`;
  particle.style.top = `${Math.random() * window.innerHeight}px`;
  container.appendChild(particle);
  return particle;
}

function animateName() {
  const rect = name.getBoundingClientRect();
  const centerX = rect.left + rect.width / 2;
  const centerY = rect.top + rect.height / 2;

  for (let i = 0; i < 5; i++) {
    setTimeout(() => {
      const waveColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
      createMagneticWave(centerX, centerY, waveColor);
    }, i * 300);
  }

  for (let i = 0; i < 20; i++) {
    const types = ['dust', 'cloud', 'leaf'];
    const particle = createAttractedParticle(types[i % 3]);
    const startX = parseFloat(particle.style.left);
    const startY = parseFloat(particle.style.top);
    const targetX = centerX - startX;
    const targetY = centerY - startY;

    particle.style.setProperty('--targetX', `${targetX}px`);
    particle.style.setProperty('--targetY', `${targetY}px`);

    gsap.to(particle, {
      duration: 1.5,
      ease: "power2.in",
      onStart: () => {
        particle.style.animation = 'attractParticle 1.5s ease-in forwards';
      },
      onComplete: () => {
        container.removeChild(particle);
      }
    });
  }

  gsap.to(name, {
    keyframes: [
      { duration: 0.1, scale: 1.1, ease: "power1.inOut" },
      { duration: 0.1, scale: 1, ease: "power1.inOut" },
      { duration: 0.3, rotation: 5, ease: "elastic.out(1, 0.3)" },
      { duration: 0.3, rotation: -5, ease: "elastic.out(1, 0.3)" },
      { duration: 0.3, rotation: 0, ease: "elastic.out(1, 0.3)" }
    ]
  });

  gsap.to(name, {
    keyframes: [
      { duration: 0.5, y: -10, ease: "power1.out" },
      { duration: 0.5, y: 0, ease: "bounce.out" }
    ]
  });
}

name.addEventListener('dblclick', animateName);

function updateScene(progress) {
  updateColors(progress);

  const mountainColor = progress < 25 ? '#FF9966' :
                        progress < 50 ? '#4b6cb7' :
                        progress < 75 ? '#FF6B6B' :
                        '#1a2a6c';
  
  gsap.to('#mountains', { fill: mountainColor, duration: 2 });

  const houseScale = progress < 75 ? 1 : 0.8;
  const houseY = progress < 75 ? 0 : 10;
  gsap.to('#houses', { scale: houseScale, y: houseY, duration: 2 });

  const nameY = progress < 75 ? -40 : -20;
  gsap.to('#name', { y: nameY, duration: 1 });

  if (progress < 75) {
    gsap.to(sun, {
      y: -Math.sin((progress / 75) * Math.PI) * 30,
      duration: 0.5
    });
  } else {
    gsap.to(moon, {
      y: -Math.sin(((progress - 75) / 25) * Math.PI) * 20,
      duration: 0.5
    });
  }

  const moonPhase = (progress - 75) / 25;
  gsap.to(moon, {
    clipPath: `inset(0 ${moonPhase * 100}% 0 0)`,
    duration: 0.5
  });

  const cloudOpacity = progress < 75 ? 1 : 0;
  const starOpacity = progress >= 75 ? 1 : 0;
  
  gsap.to('.cloud', { opacity: cloudOpacity, duration: 0.5 });
  gsap.to('.star', { opacity: starOpacity, duration: 0.5 });

  rainbow.style.opacity = (progress < 75 && isRaining) ? 0.5 : 0;

  const streamColor = progress < 25 ? '#87CEFA' :
                      progress < 50 ? '#4FC3F7' :
                      progress < 75 ? '#0288D1' :
                      '#01579B';
  gsap.to('#stream1, #stream2, #stream3', { stroke: streamColor, duration: 2 });

  if (progress >= 75) {
    if (witches.length === 0) {
      witches = animateWitches();
    }
    witches.forEach(witch => witch.style.display = 'block');
    
    if (Math.random() < 0.1) createTrailingStar();
  } else {
    witches.forEach(witch => {
      witch.style.display = 'none';
    });
  }
}

slider.addEventListener('input', () => {
  const progress = slider.value;
  updateScene(progress);
});

// Initial setup
updateScene(0);
for (let i = 0; i < 15; i++) {
  createCloud();
}

// Create initial leaves
for (let i = 0; i < 10; i++) {
  createLeaf();
}

// Responsive design
window.addEventListener('resize', () => {
  updateScene(slider.value);
});

// Rain feature
function toggleRain() {
  isRaining = !isRaining;
  if (isRaining) {
    for (let i = 0; i < 100; i++) {
      createRaindrop();
    }
    rainToggle.textContent = "Stop Rain";
    if (parseInt(slider.value) < 75) {
      rainbow.style.opacity = 0.7;
    }
  } else {
    stopRain();
    rainToggle.textContent = "Start Rain";
    rainbow.style.opacity = 0;
  }
}

function createRaindrop() {
  const raindrop = document.createElement('div');
  raindrop.className = 'raindrop';
  raindrop.style.position = 'absolute';
  raindrop.style.left = Math.random() * window.innerWidth + 'px';
  raindrop.style.top = -10 + 'px';
  raindrop.style.width = '2px';
  raindrop.style.height = Math.random() * 20 + 10 + 'px';
  raindrop.style.background = 'linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(255,255,255,0.6))';
  container.appendChild(raindrop);

  gsap.to(raindrop, {
    y: window.innerHeight + 10,
    duration: Math.random() * 1 + 0.5,
    ease: "none",
    onComplete: () => {
      container.removeChild(raindrop);
      if (isRaining) createRaindrop();
    }
  });
}

function stopRain() {
  const raindrops = document.querySelectorAll('.raindrop');
  raindrops.forEach(raindrop => {
    gsap.killTweensOf(raindrop);
    container.removeChild(raindrop);
  });
}

rainToggle.addEventListener('click', toggleRain);

// Easter egg: Double-click name to make it dance
name.addEventListener('touchstart', handleNameLongPressStart);
name.addEventListener('touchend', handleNameLongPressEnd);
name.addEventListener('mousedown', handleNameLongPressStart);
name.addEventListener('mouseup', handleNameLongPressEnd);
name.addEventListener('blur', finishNameEdit);

function handleNameLongPressStart() {
  longPressTimer = setTimeout(() => {
    makeNameEditable();
  }, 6000); // 6 seconds
}

function handleNameLongPressEnd() {
  clearTimeout(longPressTimer);
}

function makeNameEditable() {
  if (!isEditingName) {
    isEditingName = true;
    name.contentEditable = true;
    name.focus();
    
    const range = document.createRange();
    range.selectNodeContents(name);
    range.collapse(false);
    const selection = window.getSelection();
    selection.removeAllRanges();
    selection.addRange(range);
  }
}

function finishNameEdit() {
  if (isEditingName) {
    isEditingName = false;
    name.contentEditable = false;
    saveCustomName();
    adjustNameSize();
  }
}

function saveCustomName() {
  localStorage.setItem('customName', name.textContent);
}

function loadCustomName() {
  const customName = localStorage.getItem('customName');
  if (customName) {
    name.textContent = customName;
  }
  adjustNameSize();
}

window.addEventListener('load', () => {
  loadCustomName();
  loadTasks();
  loadSharedTasks();
  setThemeBasedOnIndianTime();
  if (!localStorage.getItem('userId')) {
    generateUserId();
  }
});

// Rainbow animation
function animateRainbow() {
  gsap.to(rainbow, {
    rotation: 360,
    duration: 60,
    repeat: -1,
    ease: "none"
  });
}

animateRainbow();

// Set theme based on Indian time
function setThemeBasedOnIndianTime() {
  const indianTime = new Date().toLocaleString("en-US", {timeZone: "Asia/Kolkata"});
  const indianHour = new Date(indianTime).getHours();
  const indianMinute = new Date(indianTime).getMinutes();
  
  let progress;
  if (indianHour >= 5 && indianHour < 8) {
    progress = 0; // Sunrise
  } else if (indianHour >= 8 && indianHour < 16) {
    progress = 25; // Day
  } else if ((indianHour === 16 && indianMinute >= 0) || (indianHour > 16 && indianHour < 18) || (indianHour === 18 && indianMinute <= 30)) {
    progress = 50; // Sunset (4:00 PM to 6:30 PM)
  } else {
    progress = 75; // Night
  }
  
  slider.value = progress;
  updateScene(progress);
}

// Call this function when the page loads
window.addEventListener('load', setThemeBasedOnIndianTime);

// Initialize the scene
updateScene(0);
</script>
</body>
</html>